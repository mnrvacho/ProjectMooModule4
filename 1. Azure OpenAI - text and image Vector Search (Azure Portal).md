# Azure AI Search로 Azure OpenAI 텍스트 및 이미지 벡터 검색 (Azure Portal)

Azure SQL Database를 사용하여 Azure SQL에 있는 데이터를 사용하고 Azure SQL 데이터베이스 자체에서 직접 OpenAI와 통합하여 RAG(Retrieval Augmented Generation)를 수행하는 방법에 대한 단계별 가이드를 찾을 수 있습니다. 자연어로 쿼리를 하고 Azure SQL Database에 있는 데이터를 사용하여 OpenAI GPT 모델에서 답변을 얻을 수 있습니다.

<br/>

> [!NOTE]  
> 본 실습은 [Microsoft Learn (빠른 시작: Azure Portal을 사용하여 텍스트 및 이미지 벡터화)](https://learn.microsoft.com/ko-kr/azure/search/search-get-started-portal-import-vectors)를 활용합니다.

<br/>

## 시작 

### 사전 확인 사항

* Azure 구독: Azure OpenAI, Azure AI Service, Azure AI Search, Azure Storage Account 등의 Azure 리소스를 배포하게 됩니다. 권한이 있는지 확인해주세요.
* Azure AI Search와 Azure AI 서비스는 동일한 지역에 있어야 하며, 기본 계층 이상을 권장합니다.
* 활용할 수 있는 텍스트 임베딩 모델은 Azure OpenAI의 text-embedding-ada-002, text-embedding-3-large, text-embedding-3-small 그리고 Azure AI Foundry 모델 카탈로그의 Cohere-embed-v3-english, Cohere-embed-v3-multilingual 입니다.
* 활용할 수 있는 이미지 임베딩 모델은 Azure AI Foundry 모델 카탈로그의 Facebook-DinoV2-Image-Embeddings-ViT-Base, Facebook-DinoV2-Image-Embeddings-ViT-Giant 입니다. 
* PDF 데이터 샘플 [(다운로드)](https://github.com/Azure-Samples/azure-search-sample-data/tree/main/health-plan) 

  <br/>

### Azure AI Search 생성
1. [Azure Portal](https://portal.azure.com/)에서 Azure AI Search 리소스를 생성합니다. [Azure Portal에서 Azure AI Search 서비스 만들기](https://learn.microsoft.com/ko-kr/azure/search/search-create-service-portal) 가이드를 참고하세요.

<br/> 


### Azure Storage Account (Blob Storage) 구성 

1. [Azure Portal](https://portal.azure.com/)에서 Azure 스토리지 계정 리소스를 생성합니다. [Azure Storage 계정 만들기](https://learn.microsoft.com/ko-kr/azure/storage/common/storage-account-create?tabs=azure-portal) 가이드를 참고하세요.

2. 생성된 스토리지 계정의 좌측 메뉴 [데이터 스토리지] -> [컨테이너]에서 [+컨테이너]를 클릭하여 새 컨테이너 'health-plan'을 생성합니다.

3. 컨테이너 'health-plan'에서 [업로드]를 클릭하여 다운받은 PDF 데이터 샘플을 모두 업로드합니다.

4. 스토리지 계정의 좌측 메뉴 [액세스 제어(IAM)] -> [+추가] -> [역할 할당 추가] -> **Storage Blob 데이터 Reader** 선택 후 [다음] -> **관리 ID** -> [+구성원 선택]

5. 해당 구독 선택 -> '관리 ID': **Search Service** -> 해당 Azure AI Search 서비스 [선택] -> [검토 + 할당]

6. 스토리지 계정 좌측 메뉴 [데이터 관리] -> [데이터 보호] -> **Blob에 일시 삭제 사용** 체크 -> [저장]

<br/>   


### Azure OpenAI 구성 

1. 


<br/> 


### Azure SQL Database 리소스 생성

1. [Azure Portal](https://portal.azure.com/)에서 Azure SQL Database를 생성합니다. [빠른 시작: Azure Portal을 사용하여 Azure SQL Database에서 단일 데이터베이스 만들기](https://docs.microsoft.com/azure/azure-sql/database/single-database-create-quickstart?tabs=azure-portal) 가이드에 따라 새 Azure SQL Database를 만들 수 있습니다.

1. 기존 SQL Database Server가 없는 경우 새로 생성합니다. **Authentication method**는 **'Use both SQL and Microsoft Entra authentication'**으로 선택하여 *Server admin login 정보*를 입력합니다. **Compute + Storage**는 **'Basic: 2GB 스토리지'**, **Backup storage redundancy**는 **'Locally-redundant backup'** 을 선택합니다. 
<img src="https://github.com/user-attachments/assets/197a13e5-5aed-407d-ab71-e2f4875e1dc4"  width="500">

1. `01-create-table.sql` 를 사용하여 Walmart 데이터 세트를 가져올 테이블 `walmart_ecommerce_product_details`을 만듭니다. https://github.com/mnrvacho/ProjectMooModule2/blob/main/2.%20sqldb%20scripts/01-create-table.sql 
  
1. Azure SQL DB 생성 시 입력한 **SQL server authentication 정보 또는 Microsoft Entra** 를 이용하여 쿼리편집기에 연결합니다. 

    ![image](https://github.com/user-attachments/assets/147bdc3b-70ac-403e-b318-b1f2b0dbc108)

    ![image](https://github.com/user-attachments/assets/682fcd50-487e-44dd-8db5-464be6805b31)

  <br/> 


### Vector Embeddings로 보강된 공개 Walmart US Product 데이터 세트 다운로드
















